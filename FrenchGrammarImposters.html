<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>French Grammar Impostors</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .game-title {
            font-size: 2.5em;
            font-weight: bold;
            color: #ff6b6b;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
        }

        .version {
            font-size: 0.9em;
            color: #4ecdc4;
            margin-bottom: 30px;
        }

        .game-stats {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
            font-size: 1.1em;
            justify-content: center;
        }

        .stat {
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 20px;
            border: 2px solid #4ecdc4;
        }

        .crewmates-area {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
            width: 100%;
            max-width: 1000px;
        }

        .crewmate {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 3px solid #4ecdc4;
            transition: all 0.3s ease;
        }

        .crewmate.dead {
            opacity: 0.3;
            border-color: #666;
            background: rgba(255,0,0,0.1);
        }

        .crewmate.ejected {
            opacity: 0.2;
            border-color: #333;
            background: rgba(0,0,0,0.3);
        }

        .crewmate-body {
            width: 60px;
            height: 80px;
            margin: 0 auto 15px;
            border-radius: 30px 30px 15px 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }

        .speech-bubble {
            background: white;
            color: #333;
            padding: 12px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            margin: 10px 0;
            position: relative;
            font-weight: 500;
            line-height: 1.3;
        }

        .speech-bubble::after {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            border: 10px solid transparent;
            border-bottom-color: white;
            z-index: 10;
        }

        .voting-area {
            width: 100%;
            max-width: 800px;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }

        .vote-title {
            font-size: 1.5em;
            color: #ff6b6b;
            margin-bottom: 20px;
        }

        .vote-btn, .new-game-btn {
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }

        .vote-btn:hover, .new-game-btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }

        .vote-btn:disabled {
            background: #666 !important;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .new-game-btn {
            background: #ff6b6b;
            border-radius: 25px;
            font-size: 1.1em;
            padding: 15px 30px;
            margin: 20px 0;
        }

        .game-message {
            font-size: 1.2em;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-family: 'Courier New', monospace;
            background: rgba(78, 205, 196, 0.2);
            border: 2px solid #4ecdc4;
            color: #4ecdc4;
        }

        .dead-crewmate-display {
            text-align: center;
            margin: 15px 0;
        }

        .dead-crewmate-body-small {
            width: 40px;
            height: 50px;
            margin: 10px auto;
            border-radius: 20px 20px 10px 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }

        .emergency-meeting-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            transition: transform 0.2s ease;
        }

        .emergency-meeting-btn:hover {
            transform: scale(1.1);
        }

        .emergency-meeting-btn img {
            max-width: 100px;
            height: auto;
        }
    </style>
</head>
<body>
    <h1 class="game-title">French Grammar Impostors</h1>
    <div class="version">Version 3.0</div>
    
    <div class="voting-area">
        <div class="vote-title">üö® R√©union d'urgence! üö®</div>
        <p id="voteInstructions">Les imposteurs parlent fran√ßais avec la grammaire anglaise.<br><br>Votez pour √©liminer celui que vous pensez √™tre un imposteur.</p>
        <div id="voteButtons"></div>
    </div>



    <div class="crewmates-area" id="crewmatesArea"></div>

    <button class="new-game-btn" onclick="startNewGame()">Nouvelle Partie</button>

    <script>
        const phrasePairs = [
            { correct: "Lundi, j'ai un match de soccer.", impostor: "Sur lundi, j'ai un match de soccer." },
            { correct: "J'ai regard√© un film √† la t√©l√©vision.", impostor: "J'ai regard√© un film sur la t√©l√©vision." },
            { correct: "Je n'ai pas de crayon.", impostor: "Je n'ai pas un crayon." },
            { correct: "J'ai chaud. Est-ce que je peux avoir un verre d'eau?", impostor: "Je suis chaud. Est-ce que je peux avoir un verre de l'eau?" },
            { correct: "Qu'est-ce que tu fais ici? Oh, rien du tout!", impostor: "Quoi est-ce que tu fais ici? Oh, rien!" },
            { correct: "Quelle heure est-il?", impostor: "Quel temps est-il?" },
            { correct: "Je vais chez le m√©decin.", impostor: "Je vais au m√©decin." },
            { correct: "Je suis all√© √† Victoria.", impostor: "J'ai all√© √† Victoria." },
            { correct: "J'ai peur et j'ai froid.", impostor: "J'ai peur et je suis froid." },
            { correct: "Je l'aime parce qu'il est le meilleur.", impostor: "Je l'aime lui parce qu'il est le meilleur." }
        ];

        const standaloneImpostorPhrases = [
            { impostor: "Je mange le petit-d√©jeuner ce matin.", correct: "Je prends le petit-d√©jeuner ce matin." },
            { impostor: "Je suis excit√© pour la f√™te.", correct: "J'ai h√¢te d'aller √† la f√™te." },
            { impostor: "Mon chien est tr√®s grand et amical.", correct: "Mon chien est tr√®s grand et gentil." },
            { impostor: "Je suis en train de faire mes devoirs pour trois heures.", correct: "Je fais mes devoirs depuis trois heures." },
            { impostor: "C'est un beau jour pour dehors.", correct: "C'est un beau jour pour sortir." }
        ];

        const crewmateData = [
            {name: 'Rouge', color: '#C51111'}, {name: 'Bleu', color: '#132ED1'},
            {name: 'Vert', color: '#117F2D'}, {name: 'Rose', color: '#ED54BA'},
            {name: 'Orange', color: '#EF7D0D'}, {name: 'Jaune', color: '#F5F557'},
            {name: 'Noir', color: '#000000'}, {name: 'Blanc', color: '#FFFFFF'},
            {name: 'Violet', color: '#6B2FBB'}, {name: 'Marron', color: '#8B4513'},
            {name: 'Cyan', color: '#00FFFF'}, {name: 'Vert lime', color: '#32CD32'}
        ];

        let gameState = { crewmates: [], impostors: [], round: 1, gameOver: false, currentDeadCrewmate: -1, isRevealing: false };
        let audioContext = null, clickBuffer = null;

        function initAudio() {
            if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }

        function createClickBuffer() {
            if (!audioContext || clickBuffer) return clickBuffer;
            const bufferSize = audioContext.sampleRate * 0.02;
            clickBuffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const output = clickBuffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                if (i < bufferSize * 0.1) output[i] = (Math.random() * 2 - 1) * Math.pow((bufferSize * 0.1 - i) / (bufferSize * 0.1), 2);
                else if (i < bufferSize * 0.3) output[i] = (Math.random() * 2 - 1) * 0.3 * Math.pow((bufferSize * 0.3 - i) / (bufferSize * 0.2), 3);
                else output[i] = 0;
            }
            return clickBuffer;
        }

        function scheduleClick(time) {
            if (!audioContext || !clickBuffer) return;
            const source = audioContext.createBufferSource();
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();
            source.buffer = clickBuffer;
            filter.type = 'highpass';
            filter.frequency.value = 2000;
            filter.Q.value = 1;
            gainNode.gain.value = 0.15;
            source.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            source.start(time);
        }

        function revealTextWithSync(element, text, onComplete) {
            if (gameState.isRevealing) return;
            gameState.isRevealing = true;
            initAudio();
            createClickBuffer();
            element.innerHTML = '<span class="reveal-text"></span>';
            const textSpan = element.querySelector('.reveal-text');
            const charTimings = [];
            let currentTime = 0;
            for (let i = 0; i < text.length; i++) {
                charTimings.push(currentTime);
                currentTime += (i >= 2 && text[i] === '.' && text[i-1] === '.' && text[i-2] === '.' && i < text.length - 1) ? 1200 : 60;
            }
            if (audioContext) {
                const startTime = audioContext.currentTime + 0.1;
                for (let i = 0; i < text.length; i++) scheduleClick(startTime + charTimings[i] / 1000);
            }
            let startTimestamp = null, currentIndex = 0;
            function animate(timestamp) {
                if (!startTimestamp) startTimestamp = timestamp;
                const elapsed = timestamp - startTimestamp;
                while (currentIndex < text.length && elapsed >= charTimings[currentIndex]) {
                    textSpan.innerHTML = text.substring(0, ++currentIndex);
                }
                if (currentIndex < text.length) requestAnimationFrame(animate);
                else { gameState.isRevealing = false; if (onComplete) onComplete(); }
            }
            requestAnimationFrame(animate);
        }

        function initializeGame() {
            gameState = { crewmates: [], impostors: [], round: 1, gameOver: false, currentDeadCrewmate: -1, isRevealing: false };
            document.querySelector('.vote-title').innerHTML = 'üö® R√©union d\'urgence! üö®';
            document.getElementById('voteInstructions').innerHTML = 'Les imposteurs parlent fran√ßais avec la grammaire anglaise.<br><br>Votez pour √©liminer celui que vous pensez √™tre un imposteur.';
            const shuffledPairs = [...phrasePairs].sort(() => Math.random() - 0.5);
            const shuffledStandalone = [...standaloneImpostorPhrases].sort(() => Math.random() - 0.5);
            const shuffledCrewmateData = [...crewmateData].sort(() => Math.random() - 0.5);

            for (let i = 0; i < 7; i++) {
                gameState.crewmates.push({
                    id: i, phrase: shuffledPairs[i].correct, isImpostor: false,
                    alive: true, ejected: false, color: shuffledCrewmateData[i].color,
                    name: shuffledCrewmateData[i].name, pairIndex: i
                });
            }

            gameState.crewmates.push({
                id: 7, phrase: shuffledPairs[0].impostor, correctPhrase: shuffledPairs[0].correct,
                isImpostor: true, alive: true, ejected: false, color: shuffledCrewmateData[7].color,
                name: shuffledCrewmateData[7].name, pairIndex: 0, impostorType: 'paired'
            });
            gameState.impostors.push(7);

            const secondPairIndex = Math.floor(Math.random() * 6) + 1;
            gameState.crewmates.push({
                id: 8, phrase: shuffledPairs[secondPairIndex].impostor,
                correctPhrase: shuffledPairs[secondPairIndex].correct, isImpostor: true,
                alive: true, ejected: false, color: shuffledCrewmateData[8].color,
                name: shuffledCrewmateData[8].name, pairIndex: secondPairIndex, impostorType: 'paired'
            });
            gameState.impostors.push(8);

            for (let i = 9; i < 12; i++) {
                gameState.crewmates.push({
                    id: i, phrase: shuffledStandalone[i - 9].impostor,
                    correctPhrase: shuffledStandalone[i - 9].correct, isImpostor: true,
                    alive: true, ejected: false, color: shuffledCrewmateData[i].color,
                    name: shuffledCrewmateData[i].name, impostorType: 'standalone'
                });
                gameState.impostors.push(i);
            }

            gameState.currentDeadCrewmate = 0;
            gameState.crewmates[0].alive = false;
            updateDisplay();
        }

        function updateDisplay() {
            const aliveImpostors = gameState.crewmates.filter(c => c.isImpostor && c.alive && !c.ejected).length;
            const aliveInnocents = gameState.crewmates.filter(c => !c.isImpostor && c.alive && !c.ejected).length;

            const crewmatesArea = document.getElementById('crewmatesArea');
            crewmatesArea.innerHTML = gameState.crewmates.map(c => `
                <div class="crewmate ${c.alive ? 'alive' : 'dead'} ${c.ejected ? 'ejected' : ''}">
                    <div class="crewmate-body" style="background-color: ${c.color}">
                        ${c.alive && !c.ejected ? 'üë§' : (c.ejected ? 'üíÄ' : '‚ò†Ô∏è')}
                    </div>
                    <div class="speech-bubble">${c.phrase}</div>
                    <button class="vote-btn" style="background-color: ${c.color}; color: ${c.color === '#FFFFFF' || c.color === '#F5F557' ? '#000' : '#FFF'}"
                        onclick="vote(${c.id})" ${!c.alive || c.ejected || gameState.isRevealing || gameState.gameOver ? 'disabled' : ''}>
                        Voter ${c.name}
                    </button>
                </div>
            `).join('');

            const voteButtons = document.getElementById('voteButtons');
            const voteInstructions = document.getElementById('voteInstructions');
            if (gameState.gameOver) {
                voteButtons.innerHTML = '<p style="color: #4ecdc4;">Jeu termin√© - Aucun vote disponible</p>';
            } else if (gameState.isRevealing) {
                voteButtons.innerHTML = '';
            } else {
                if (gameState.currentDeadCrewmate !== -1) {
                    const dead = gameState.crewmates[gameState.currentDeadCrewmate];
                    voteInstructions.innerHTML = `Un co√©quipier est mort !<div class="dead-crewmate-display">
                        <div class="dead-crewmate-body-small" style="background-color: ${dead.color}">‚ò†Ô∏è</div>
                        <div style="color: ${dead.color === '#FFFFFF' || dead.color === '#F5F557' ? '#000' : '#FFF'}; font-weight: bold;">${dead.name}</div>
                    </div>Les imposteurs parlent fran√ßais avec la grammaire anglaise.<br><br>Votez pour √©liminer celui que vous pensez √™tre un imposteur.`;
                }
                voteButtons.innerHTML = '';
            }
            checkGameEnd();
        }

        function vote(crewmateId) {
            if (gameState.isRevealing || gameState.gameOver) return;
            const votedCrewmate = gameState.crewmates[crewmateId];
            votedCrewmate.ejected = true;
            updateDisplay();
            startSuspensefulReveal(votedCrewmate);
        }

        function startSuspensefulReveal(votedCrewmate) {
            window.scrollTo({ top: 0, behavior: 'smooth' });
            document.querySelector('.vote-title').innerHTML = 'üìä R√©sultats du vote';

            // Show transparent button immediately for spacing, with stats below
            document.getElementById('voteButtons').innerHTML = `
                <br><button class="emergency-meeting-btn" onclick="startEmergencyMeeting()" style="opacity: 0; pointer-events: none;" disabled><img src="Emergency_button.png" alt="Emergency Meeting Button"></button>
                <br><br>
                <div class="game-stats">
                    <div class="stat">Imposteurs: <span id="impostorsLeft">-</span></div>
                    <div class="stat">Co√©quipiers: <span id="crewmatesLeft">-</span></div>
                    <div class="stat">Manche: <span id="round">${gameState.round}</span></div>
                </div>
            `;

            let revealText = votedCrewmate.isImpostor
                ? `"${votedCrewmate.phrase}" utilise la grammaire anglaise...<br>Le fran√ßais correct est : "${votedCrewmate.correctPhrase}"...<br>${votedCrewmate.name} √©tait un imposteur.`
                : `"${votedCrewmate.phrase}" utilise les r√®gles de grammaire fran√ßaise...<br>${votedCrewmate.name} n'√©tait pas un imposteur.`;

            revealTextWithSync(document.getElementById('voteInstructions'), revealText, () => {
                if (votedCrewmate.isImpostor) gameState.impostors = gameState.impostors.filter(id => id !== votedCrewmate.id);
                gameState.round++;
                gameState.currentDeadCrewmate = -1;

                // Update the stats with actual values and make the button visible and clickable
                const aliveImpostors = gameState.crewmates.filter(c => c.isImpostor && c.alive && !c.ejected).length;
                const aliveInnocents = gameState.crewmates.filter(c => !c.isImpostor && c.alive && !c.ejected).length;

                document.getElementById('voteButtons').innerHTML = `
                    <br><button class="emergency-meeting-btn" onclick="startEmergencyMeeting()"><img src="Emergency_button.png" alt="Emergency Meeting Button"></button>
                    <br><br>
                    <div class="game-stats">
                        <div class="stat">Imposteurs: <span id="impostorsLeft">${aliveImpostors}</span></div>
                        <div class="stat">Co√©quipiers: <span id="crewmatesLeft">${aliveInnocents}</span></div>
                        <div class="stat">Manche: <span id="round">${gameState.round}</span></div>
                    </div>
                `;
            });
        }

        function killNextCrewmate() {
            const aliveInnocents = gameState.crewmates.filter(c => c.alive && !c.ejected && !c.isImpostor);
            if (aliveInnocents.length > 0) {
                const victim = aliveInnocents[Math.floor(Math.random() * aliveInnocents.length)];
                victim.alive = false;
                gameState.currentDeadCrewmate = victim.id;
            }
        }

        function checkGameEnd() {
            const aliveImpostors = gameState.crewmates.filter(c => c.isImpostor && c.alive && !c.ejected).length;
            const aliveInnocents = gameState.crewmates.filter(c => !c.isImpostor && c.alive && !c.ejected).length;
            const voteTitle = document.querySelector('.vote-title');
            const voteInstructions = document.getElementById('voteInstructions');
            
            if (aliveImpostors === 0) {
                voteTitle.innerHTML = 'üéâ Victory!';
                voteInstructions.innerHTML = 'You found all the grammar impostors! Hugo has saved the French language!<br><br><button class="new-game-btn" onclick="startNewGame()">Nouvelle Partie</button>';
                gameState.gameOver = true;
            } else if (aliveImpostors >= aliveInnocents) {
                voteTitle.innerHTML = 'üíÄ Game Over!';
                voteInstructions.innerHTML = `The grammar impostors have taken over! The remaining impostors were: ${gameState.crewmates.filter(c => c.isImpostor && c.alive && !c.ejected).map(c => c.name).join(', ')}<br><br><button class="new-game-btn" onclick="startNewGame()">Nouvelle Partie</button>`;
                gameState.gameOver = true;
            }
        }

        function startEmergencyMeeting() {
            // Play emergency meeting sound
            playEmergencyMeetingSound();

            // Kill next crewmate and start new round
            killNextCrewmate();
            document.querySelector('.vote-title').innerHTML = 'üö® R√©union d\'urgence! üö®';
            document.getElementById('voteButtons').innerHTML = '<p>Cliquez sur le bouton sous chaque personnage pour voter pour l\'√©liminer!</p>';
            updateDisplay();
        }

        function playEmergencyMeetingSound() {
            // Try to play the EmergencyMeetingSound.mp3 file
            const audio = new Audio('EmergencyMeetingSound.mp3');
            audio.volume = 0.5;
            audio.play().catch(error => {
                console.log('Could not play emergency meeting sound:', error);
            });
        }

        function startNewGame() { initializeGame(); }
        document.addEventListener('click', () => { if (audioContext && audioContext.state === 'suspended') audioContext.resume(); });
        initializeGame();
    </script>
</body>
</html>
<!-- Streamlined from 733 lines to 297 lines on 2025-09-25 -->